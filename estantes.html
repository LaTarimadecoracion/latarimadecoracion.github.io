<!DOCTYPE html>
<html lang="es">
<head>
		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-JXNJV3XERK"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-JXNJV3XERK');
		</script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Estantes | LA TARIMA</title>
	<link rel="stylesheet" href="estilos.css">
	<link rel="icon" href="img/ico.png" type="image/png">
</head>
<body class="barandas">
	<div class="container">
		<a href="index.html" style="text-decoration:none; color:inherit;">
			<h1 style="cursor:pointer;">LA TARIMA</h1>
		</a>
		<a href="index.html" style="text-decoration:none; color:inherit;">
			<div class="subtitle" style="cursor:pointer;">Carpintería Online</div>
		</a>
		<div class="socials">
			<a href="https://www.tiktok.com/@latarimadecoracion" target="_blank" rel="noopener" aria-label="TikTok">
				<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M16 3c.3 2 1.7 3.6 3.6 3.9.3 0 .4.2.4.4v2.2c0 .3-.2.5-.5.5-1.7 0-3.3-.6-4.5-1.6v6.6c0 3-2.4 5.5-5.4 5.7-3.2.2-5.9-2.4-5.9-5.6 0-3.1 2.5-5.6 5.6-5.6.4 0 .8 0 1.1.1.2 0 .3.2.3.4v2.3c0 .2-.2.4-.4.4-.3-.1-.6-.1-.9-.1-1.6 0-2.9 1.4-2.8 3 .1 1.5 1.4 2.7 3 2.7 1.6 0 2.9-1.3 2.9-2.9V3.5c0-.3.2-.5.5-.5H16z"/></svg>
			</a>
			<a href="https://www.instagram.com/latarimadecoracion" target="_blank" rel="noopener" aria-label="Instagram">
				<svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="5" ry="5"></rect><circle cx="12" cy="12" r="4"></circle><circle cx="17" cy="7" r="1.5"></circle></svg>
			</a>
			<a href="https://www.facebook.com/latarimadecoracion" target="_blank" rel="noopener" aria-label="Facebook">
				<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M13 22v-9h3l.5-3H13V8.5c0-.9.3-1.5 1.7-1.5H16V4.3c-.3 0-1.2-.1-2.2-.1-2.2 0-3.8 1.3-3.8 3.9V10H7v3h3v9h3z"/></svg>
			</a>
			<a href="https://www.youtube.com/@latarimadecoracion" target="_blank" rel="noopener" aria-label="YouTube">
				<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M23.5 7.2c-.3-1.2-1.2-2.1-2.4-2.4C19 4.3 12 4.3 12 4.3s-7 0-9.1.5C1.7 5.1.8 6 .5 7.2.1 9.3.1 12 .1 12s0 2.7.4 4.8c.3 1.2 1.2 2.1 2.4 2.4C5 19.7 12 19.7 12 19.7s7 0 9.1-.5c1.2-.3 2.1-1.2 2.4-2.4.4-2.1.4-4.8.4-4.8s0-2.7-.4-4.8zM9.8 15.5V8.5l6 3.5-6 3.5z"/></svg>
			</a>
			<a href="https://wa.me/5491167007723" target="_blank" rel="noopener" aria-label="WhatsApp">
				<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.488"/></svg>
			</a>
		</div>
		<div class="product-stack" id="product-stack"></div>
		<nav class="split-btn" aria-label="Acciones de navegación y contacto">
			<a href="index.html" title="Volver al inicio">INICIO</a>
			<a href="https://wa.me/5491167007723" class="consultar" target="_blank" rel="noopener" title="Consultar por WhatsApp">CONSULTAR</a>
		</nav>
	</div>
	<script type="module">
	// Configuración de imágenes por modelo
	const IMAGES = {
		'Estantes Montessori': 'img/estantes/montessori.jpg',
		'Librero': 'img/estantes/librero.jpg',
		'Hexagonales': 'img/estantes/hexagonales.jpg',
		'Triángulos': 'img/estantes/triangulos.jpg',
		'Cuadrados': 'img/estantes/cuadrados.jpg',
		'Ménsulas': 'img/estantes/mensulas.jpg',
		'Estantes': 'img/estantes/estantes.jpg'
	};
	// Normaliza el modelo para agrupar correctamente
	function getModeloKey(modelo) {
		if (!modelo) return '';
		const m = modelo.toLowerCase();
		if (m.includes('montessori')) return 'Estantes Montessori';
		if (m.includes('librero')) return 'Librero';
		if (m.includes('hexagonales')) return 'Hexagonales';
		if (m.includes('triángulos')) return 'Triángulos';
		if (m.includes('cuadrados')) return 'Cuadrados';
		if (m.includes('ménsulas')) return 'Ménsulas';
		if (m.includes('estantes')) return 'Estantes';
		return modelo;
	}
	// Carga los productos del módulo estantes
	async function getEstantes() {
		try {
			const res = await fetch('Links/links.json', { cache: 'no-store' });
			if (!res.ok) throw new Error('No se pudo cargar links.json');
			const json = await res.json();
			if (!json.modules || !json.modules.estantes) throw new Error('No existe el módulo estantes en el JSON');
			return json.modules.estantes;
		} catch (e) {
			console.error('Error cargando productos:', e);
			return [];
		}
	}
	// Agrupa productos por modelo
	function groupByModelo(rows) {
		const grupos = {};
		rows.forEach(row => {
			const key = getModeloKey(row.modelo);
			if (!grupos[key]) grupos[key] = [];
			grupos[key].push(row);
		});
		return grupos;
	}
	// Renderiza las cards de productos
	function renderCards(grupos) {
		const stack = document.getElementById('product-stack');
		stack.innerHTML = '';
		Object.entries(grupos).forEach(([modelo, items]) => {
			// Agrupar por medida
			const medidas = {};
			items.forEach(item => {
				const medida = item.medida || '';
				if (!medidas[medida]) medidas[medida] = [];
				medidas[medida].push(item);
			});
			// Detectar todos los tipos de columna presentes en este modelo
			const tiposColumnasSet = new Set();
			let soloComprar = true;
			Object.values(medidas).forEach(productos => {
				productos.forEach(producto => {
					if (producto.tipo && producto.tipo !== 'combo' && producto.tipo !== 'Comprar') {
						tiposColumnasSet.add(producto.tipo);
						soloComprar = false;
					}
				});
			});
			// Ordenar tipos de columna por orden lógico
			const ordenTipos = ['1un','2un','3un','2 un','6 un','12 un'];
			const tiposColumnas = Array.from(tiposColumnasSet).sort((a,b) => ordenTipos.indexOf(a) - ordenTipos.indexOf(b));
			// Crear card
			const card = document.createElement('div');
			card.className = 'product-card';

			// --- SELECT MÓVIL UNIFICADO ---
			let mobileSelectHTML = '';
			let mobileOptions = '';
			let idx = 0;
			Object.entries(medidas).forEach(([medida, productos]) => {
				// Si hay un producto tipo combo, mostrar el botón en la columna 1un
				const combo = productos.find(p => p.tipo === 'combo');
				if (combo) {
					const href = combo.href;
					const isActive = href && href.trim() && href !== '#';
					mobileOptions += isActive ? `<option value="${href}">${medida} - Comprar</option>` : `<option value="" disabled>${medida} - Comprar (Próximamente)</option>`;
					idx++;
					return;
				}
				// Si todos los productos son tipo único (por ejemplo, solo 'Comprar'), mostrar una fila por producto
				const tiposUnicos = productos.every(p => !tiposColumnas.includes(p.tipo));
				if (tiposUnicos) {
					productos.forEach((producto) => {
						const href = producto.href;
						const isActive = href && href.trim() && href !== '#';
						mobileOptions += isActive ? `<option value="${href}">${medida || producto.tipo} - Comprar</option>` : `<option value="" disabled>${medida || producto.tipo} - Comprar (Próximamente)</option>`;
					});
					idx++;
					return;
				}
				// Buscar productos por tipo columna
				const tipos = {};
				tiposColumnas.forEach(tipo => tipos[tipo] = null);
				productos.forEach(producto => {
					if (tiposColumnas.includes(producto.tipo)) tipos[producto.tipo] = producto;
				});
				tiposColumnas.forEach(tipo => {
					const producto = tipos[tipo];
					if (producto && producto.href && producto.href.trim() && producto.href !== '#') {
						mobileOptions += `<option value="${producto.href}">${medida} - ${tipo}</option>`;
					} else {
						mobileOptions += `<option value="" disabled>${medida} - ${tipo} (Próximamente)</option>`;
					}
				});
				idx++;
			});
			mobileSelectHTML = `<div class="mobile-select-row" style="display:none;"><select class="dropbtn" id="select-${modelo.replace(/\s/g,'')}"><option value="" selected disabled>Elegir opción</option>${mobileOptions}</select></div>`;

			// --- TABLA DESKTOP ---
			let tableRows = '';
			Object.entries(medidas).forEach(([medida, productos], idx) => {
				// Si hay un producto tipo combo, mostrar el botón en la columna 1un
				const combo = productos.find(p => p.tipo === 'combo');
				if (combo) {
					const href = combo.href;
					const isActive = href && href.trim() && href !== '#';
					tableRows += `<tr class="desktop-row"><td>${medida}</td><td><a class="buy-btn${isActive ? ' primary' : ' loading-link'}" href="${isActive ? href : '#'}"${isActive ? ' target=\"_blank\" rel=\"noopener\"' : ' tabindex=\"-1\"'}>Comprar</a></td>`;
					for(let i=1;i<tiposColumnas.length;i++) tableRows += '<td></td>';
					tableRows += `</tr>`;
					return;
				}
				// Si todos los productos son tipo único (por ejemplo, solo 'Comprar'), mostrar una fila por producto
				const tiposUnicos = productos.every(p => !tiposColumnas.includes(p.tipo));
				if (tiposUnicos) {
					productos.forEach((producto, j) => {
						const href = producto.href;
						const isActive = href && href.trim() && href !== '#';
						const colspan = (tiposColumnas.length > 0) ? tiposColumnas.length : 1;
						tableRows += `<tr class="desktop-row"><td>${medida || producto.tipo}</td><td colspan="${colspan}"><a class="buy-btn${isActive ? ' primary' : ' loading-link'}" href="${isActive ? href : '#'}"${isActive ? ' target=\"_blank\" rel=\"noopener\"' : ' tabindex=\"-1\"'}>${isActive ? 'Comprar' : ''}</a></td></tr>`;
					});
					return;
				}
				// Buscar productos por tipo columna
				const tipos = {};
				tiposColumnas.forEach(tipo => tipos[tipo] = null);
				productos.forEach(producto => {
					if (tiposColumnas.includes(producto.tipo)) tipos[producto.tipo] = producto;
				});
				tableRows += `<tr class="desktop-row"><td>${medida}</td>`;
				tiposColumnas.forEach(tipo => {
					const producto = tipos[tipo];
					if (producto) {
						const href = producto.href;
						const isActive = href && href.trim() && href !== '#';
						tableRows += `<td><a class="buy-btn${isActive ? ' primary' : ' loading-link'}" href="${isActive ? href : '#'}"${isActive ? ' target=\"_blank\" rel=\"noopener\"' : ' tabindex=\"-1\"'}>${isActive ? 'Comprar' : ''}</a></td>`;
					} else {
						tableRows += `<td><a class="buy-btn loading-link" href="#" tabindex="-1"></a></td>`;
					}
				});
				tableRows += '</tr>';
			});
			// Encabezados dinámicos o solo botón si todos son 'Comprar'
			let ths = '<th>Medida</th>';
			if (soloComprar) {
				ths += '<th>Comprar</th>';
			} else {
				tiposColumnas.forEach(tipo => ths += `<th>${tipo}</th>`);
			}
			card.innerHTML = `
				<div class="product-image">
					<img src="${IMAGES[modelo]||''}" alt="${modelo}" loading="lazy">
				</div>
				<div class="product-card-title">${modelo}</div>
				${mobileSelectHTML}
				<table class="product-table">
					<thead><tr>${ths}</tr></thead>
					<tbody>${tableRows}</tbody>
				</table>
			`;
			// Listeners para select móvil
			setTimeout(() => {
				const select = card.querySelector('.mobile-select-row select');
				if (select) {
					select.addEventListener('change', function(e) {
						const url = this.value;
						if(url) window.open(url, '_blank');
						this.selectedIndex = 0;
					});
				}
			}, 0);
			stack.appendChild(card);
		});
	}
	// Inicializa la carga
	getEstantes().then(rows => {
		// Mostrar todos los modelos únicos detectados
		const modelosUnicos = Array.from(new Set(rows.map(r => r.modelo))).sort();
		console.log('[DEBUG] Modelos únicos detectados:', modelosUnicos);
		const grupos = groupByModelo(rows);
		console.log('[DEBUG] Grupos generados:', Object.keys(grupos));
		Object.keys(grupos).forEach(key => {
			if (["Hexagonales","Triángulos","Cuadrados","Ménsulas","Estantes"].includes(key)) {
				console.log(`[DEBUG] Grupo ${key}:`, grupos[key]);
			}
		});
		renderCards(grupos);
	});
	</script>
</body>
<script src="responsive-tables.js?v=20250918-2"></script>
</html>
