<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nuevo Módulo</title>
    <link rel="stylesheet" href="estilos.css?v=20250918-2">
</head>
<body>
    <img src="img/MODULO/MODULO.jpg" alt="MODULO decorativo">
    MODULO
    <table id="tabla-modulo-minorista">
        <tr>
            <th>Modelo</th>
            <th>1 un</th>
            <th>2 un</th>
            <th>3 un</th>
        </tr>
        <!-- Las filas se generan dinámicamente -->
    </table>
    Combos con descuento para mayoristas
    <table id="tabla-modulo-mayorista">
        <tr>
            <th>Modelo</th>
            <th>10 un</th>
            <th>20 un</th>
            <th>30 un</th>
        </tr>
        <!-- Las filas se generan dinámicamente -->
    </table>
    <script type="module">
        const moduleId = 'modulo';
        async function loadLinks() {
            try {
                const url = 'Links/links.json' + '?cb=' + Date.now();
                const res = await fetch(url, { cache: 'no-store' });
                if (!res.ok) throw 0;
                const json = await res.json();
                return Array.isArray(json?.modules?.[moduleId]) ? json.modules[moduleId] : [];
            } catch {
                return [];
            }
        }
        function renderButtons(links) {
            // Minorista
            const tablaMinorista = document.getElementById('tabla-modulo-minorista');
            let lastModelo = null;
            let tr = null;
            links.forEach(item => {
                if (["1un","2un","3un"].includes(item.tipo)) {
                    if (item.modelo !== lastModelo) {
                        tr = document.createElement('tr');
                        const tdModelo = document.createElement('td');
                        tdModelo.textContent = item.modelo;
                        tr.appendChild(tdModelo);
                        tablaMinorista.appendChild(tr);
                        lastModelo = item.modelo;
                    }
                    const td = document.createElement('td');
                    const btn = document.createElement('a');
                    btn.textContent = item.href && item.href.trim() ? 'Comprar' : 'Próximamente';
                    btn.href = item.href && item.href.trim() ? item.href : '#';
                    btn.target = '_blank';
                    td.appendChild(btn);
                    tr.appendChild(td);
                }
            });
            // Mayorista
            const tablaMayorista = document.getElementById('tabla-modulo-mayorista');
            lastModelo = null;
            tr = null;
            links.forEach(item => {
                if (["10un","20un","30un"].includes(item.tipo)) {
                    if (item.modelo !== lastModelo) {
                        tr = document.createElement('tr');
                        const tdModelo = document.createElement('td');
                        tdModelo.textContent = item.modelo;
                        tr.appendChild(tdModelo);
                        tablaMayorista.appendChild(tr);
                        lastModelo = item.modelo;
                    }
                    const td = document.createElement('td');
                    const btn = document.createElement('a');
                    btn.textContent = item.href && item.href.trim() ? 'Comprar' : 'Próximamente';
                    btn.href = item.href && item.href.trim() ? item.href : '#';
                    btn.target = '_blank';
                    td.appendChild(btn);
                    tr.appendChild(td);
                }
            });
        }
        (async () => {
            const links = await loadLinks();
            renderButtons(links);
        })();
    </script>
</body>
</html>
